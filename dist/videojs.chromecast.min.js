/*! videojs-chromecast - v1.1.1 - 2016-09-28
* https://github.com/kim-company/videojs-chromecast
* Copyright (c) 2016 KIM Keep In Mind GmbH, srl; Licensed MIT */

(function(){var a=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a},b={}.hasOwnProperty;vjs.addLanguage("de",{"CASTING TO":"WIEDERGABE AUF"}),vjs.addLanguage("it",{"CASTING TO":"PLAYBACK SU"}),vjs.plugin("chromecast",function(a){return this.chromecastComponent=new vjs.ChromecastComponent(this,a),this.controlBar.addChild(this.chromecastComponent)}),vjs.ChromecastComponent=function(b){function c(a,b){this.settings=b,c.__super__.constructor.call(this,a,this.settings),a.controls()||this.disable(),this.hide(),this.initializeApi()}return a(c,b),c.prototype.buttonText="Chromecast",c.prototype.inactivityTimeout=2e3,c.prototype.apiInitialized=!1,c.prototype.apiSession=null,c.prototype.apiMedia=null,c.prototype.casting=!1,c.prototype.paused=!0,c.prototype.muted=!1,c.prototype.currentVolume=1,c.prototype.currentMediaTime=0,c.prototype.timer=null,c.prototype.timerStep=1e3,c.prototype.initializeApi=function(){var a,b,c;if(vjs.IS_CHROME)return chrome.cast&&chrome.cast.isAvailable?(b=this.settings.appId||chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,c=new chrome.cast.SessionRequest(b),a=new chrome.cast.ApiConfig(c,this.sessionJoinedListener,this.receiverListener.bind(this)),chrome.cast.initialize(a,this.onInitSuccess.bind(this),this.castError)):void setTimeout(this.initializeApi.bind(this),1e3)},c.prototype.sessionJoinedListener=function(a){},c.prototype.receiverListener=function(a){if("available"===a)return this.show()},c.prototype.onInitSuccess=function(){return this.apiInitialized=!0},c.prototype.castError=function(a){return vjs.log("Cast Error: "+JSON.stringify(a))},c.prototype.doLaunch=function(){return this.apiInitialized?chrome.cast.requestSession(this.onSessionSuccess.bind(this),this.castError):vjs.log("Session not initialized")},c.prototype.onSessionSuccess=function(a){var b,c,d,e,f,g;if(this.apiSession=a,this.addClass("connected"),e=new chrome.cast.media.MediaInfo(this.player_.currentSrc(),this.player_.currentType()),this.settings.metadata){e.metadata=new chrome.cast.media.GenericMediaMetadata,f=this.settings.metadata;for(c in f)g=f[c],e.metadata[c]=g;this.player_.options_.poster&&(b=new chrome.cast.Image(this.player_.options_.poster),e.metadata.images=[b])}return d=new chrome.cast.media.LoadRequest(e),d.autoplay=!0,d.currentTime=this.player_.currentTime(),this.apiSession.loadMedia(d,this.onMediaDiscovered.bind(this),this.castError),this.apiSession.addUpdateListener(this.onSessionUpdate.bind(this))},c.prototype.onMediaDiscovered=function(a){return this.apiMedia=a,this.apiMedia.addUpdateListener(this.onMediaStatusUpdate.bind(this)),this.startProgressTimer(this.incrementMediaTime.bind(this)),this.player_.loadTech("ChromecastTech",{receiver:this.apiSession.receiver.friendlyName}),this.casting=!0,this.paused=this.player_.paused(),this.inactivityTimeout=this.player_.options_.inactivityTimeout,this.player_.options_.inactivityTimeout=0,this.player_.userActive(!0)},c.prototype.onSessionUpdate=function(a){if(this.apiMedia)return a?void 0:this.onStopAppSuccess()},c.prototype.onMediaStatusUpdate=function(a){if(this.apiMedia)switch(this.currentMediaTime=this.apiMedia.currentTime,this.apiMedia.playerState){case chrome.cast.media.PlayerState.IDLE:return this.currentMediaTime=0,this.trigger("timeupdate"),this.onStopAppSuccess();case chrome.cast.media.PlayerState.PAUSED:if(this.paused)return;return this.player_.pause(),this.paused=!0;case chrome.cast.media.PlayerState.PLAYING:if(!this.paused)return;return this.player_.play(),this.paused=!1}},c.prototype.startProgressTimer=function(a){return this.timer&&(clearInterval(this.timer),this.timer=null),this.timer=setInterval(a.bind(this),this.timerStep)},c.prototype.play=function(){if(this.apiMedia)return this.paused?(this.apiMedia.play(null,this.mediaCommandSuccessCallback.bind(this,"Playing: "+this.apiMedia.sessionId),this.onError),this.paused=!1):void 0},c.prototype.pause=function(){if(this.apiMedia)return this.paused?void 0:(this.apiMedia.pause(null,this.mediaCommandSuccessCallback.bind(this,"Paused: "+this.apiMedia.sessionId),this.onError),this.paused=!0)},c.prototype.seekMedia=function(a){var b;return b=new chrome.cast.media.SeekRequest,b.currentTime=a,this.player_.controlBar.progressControl.seekBar.videoWasPlaying&&(b.resumeState=chrome.cast.media.ResumeState.PLAYBACK_START),this.apiMedia.seek(b,this.onSeekSuccess.bind(this,a),this.onError)},c.prototype.onSeekSuccess=function(a){return this.currentMediaTime=a},c.prototype.setMediaVolume=function(a,b){var c,d;if(this.apiMedia)return d=new chrome.cast.Volume,d.level=a,d.muted=b,this.currentVolume=d.level,this.muted=b,c=new chrome.cast.media.VolumeRequest,c.volume=d,this.apiMedia.setVolume(c,this.mediaCommandSuccessCallback.bind(this,"Volume changed"),this.onError),this.player_.trigger("volumechange")},c.prototype.incrementMediaTime=function(){if(this.apiMedia.playerState===chrome.cast.media.PlayerState.PLAYING)return this.currentMediaTime<this.apiMedia.media.duration?(this.currentMediaTime+=1,this.trigger("timeupdate")):(this.currentMediaTime=0,clearInterval(this.timer))},c.prototype.mediaCommandSuccessCallback=function(a,b){return vjs.log(a)},c.prototype.onError=function(){return vjs.log("error")},c.prototype.stopCasting=function(){return this.apiSession.stop(this.onStopAppSuccess.bind(this),this.onError)},c.prototype.onStopAppSuccess=function(){return clearInterval(this.timer),this.casting=!1,this.removeClass("connected"),this.player_.src(this.player_.options_.sources),this.paused||this.player_.one("seeked",function(){return this.player_.play()}),this.player_.currentTime(this.currentMediaTime),this.player_.tech.setControls(!1),this.player_.options_.inactivityTimeout=this.inactivityTimeout,this.apiMedia=null,this.apiSession=null},c.prototype.buildCSSClass=function(){return c.__super__.buildCSSClass.apply(this,arguments)+"vjs-chromecast-button"},c.prototype.onClick=function(){return c.__super__.onClick.apply(this,arguments),this.casting?(this.player_.trigger("chromecastStop"),this.stopCasting()):(this.player_.trigger("chromecastStart"),this.doLaunch())},c}(vjs.Button),vjs.ChromecastTech=function(b){function c(a,b,d){this.featuresVolumeControl=!0,this.movingMediaElementInDOM=!1,this.featuresFullscreenResize=!1,this.featuresProgressEvents=!0,this.receiver=b.source.receiver,c.__super__.constructor.call(this,a,b,d),this.triggerReady()}return a(c,b),c.isSupported=function(){return this.player_.chromecastComponent.apiInitialized},c.canPlaySource=function(a){return"video/mp4"===a.type||"video/webm"===a.type||"application/x-mpegURL"===a.type||"application/vnd.apple.mpegURL"===a.type},c.prototype.createEl=function(){var a;return a=document.createElement("div"),a.id=this.player_.id_+"_chromecast_api",a.className="vjs-tech vjs-tech-chromecast",a.innerHTML='<div class="casting-image" style="background-image: url(\''+this.player_.options_.poster+'\')"></div>\n<div class="casting-overlay">\n  <div class="casting-information">\n    <div class="casting-icon">&#58880</div>\n    <div class="casting-description"><small>'+this.localize("CASTING TO")+"</small><br>"+this.receiver+"</div>\n  </div>\n</div>",a.player=this.player_,vjs.insertFirst(a,this.player_.el()),a},c.prototype.play=function(){return this.player_.chromecastComponent.play(),this.player_.onPlay()},c.prototype.pause=function(){return this.player_.chromecastComponent.pause(),this.player_.onPause()},c.prototype.paused=function(){return this.player_.chromecastComponent.paused},c.prototype.currentTime=function(){return this.player_.chromecastComponent.currentMediaTime},c.prototype.setCurrentTime=function(a){return this.player_.chromecastComponent.seekMedia(a)},c.prototype.volume=function(){return this.player_.chromecastComponent.currentVolume},c.prototype.setVolume=function(a){return this.player_.chromecastComponent.setMediaVolume(a,!1)},c.prototype.muted=function(){return this.player_.chromecastComponent.muted},c.prototype.setMuted=function(a){return this.player_.chromecastComponent.setMediaVolume(this.player_.chromecastComponent.currentVolume,a)},c.prototype.supportsFullScreen=function(){return!1},c}(vjs.MediaTechController)}).call(this);