(function(){var e,t,i,s,r=function(e,t){function i(){this.constructor=e}for(var s in t)o.call(t,s)&&(e[s]=t[s]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},o={}.hasOwnProperty;videojs.addLanguage("de",{"CASTING TO":"WIEDERGABE AUF"}),videojs.addLanguage("it",{"CASTING TO":"PLAYBACK SU"}),videojs.addLanguage('cy"',{"CASTING TO":"CASTIO I"}),videojs.plugin("chromecast",function(e){this.ready(function(){console.log("ready");var t=this.controlBar.addChild("ChromecastComponent",e);this.controlBar.el().insertBefore(t.el(),this.controlBar.fullscreenToggle.el())})}),s=videojs.getComponent("Button"),e=function(e){function t(e,i){this.settings=i,t.__super__.constructor.call(this,e,this.settings),e.controls()||this.disable(),this.hide(),this.initializeApi()}return r(t,e),t.prototype.buttonText="Chromecast",t.prototype.inactivityTimeout=2e3,t.prototype.apiInitialized=!1,t.prototype.currentMediaIndex=0,t.prototype.session=null,t.prototype.apiMedia=null,t.prototype.casting=!1,t.prototype.paused=!0,t.prototype.muted=!1,t.prototype.currentVolume=1,t.prototype.currentMediaTime=0,t.prototype.timer=null,t.prototype.timerStep=1e3,t.prototype.session=!1,t.prototype.initializeApi=function(){var e,t,i,s;if(videojs.browser.IS_CHROME){if(!chrome.cast||!chrome.cast.isAvailable)return void setTimeout(this.initializeApi.bind(this),1e3);t=this.settings.hasOwnProperty("appId")&&this.settings.appId||chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,s=chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED,i=new chrome.cast.SessionRequest(t),e=new chrome.cast.ApiConfig(i,this.sessionListener.bind(this),this.receiverListener.bind(this),s),chrome.cast.initialize(e,this.onInitSuccess.bind(this),this.castError)}},t.prototype.onInitSuccess=function(){console.log("init success")},t.prototype.castError=function(e){videojs.log("Cast Error: "+JSON.stringify(e))},t.prototype.sessionListener=function(e){this.session=e,console.log("session listener called"),this.session&&(this.session.media[0]?this.onMediaDiscovered(this.session.media[0]):(console.log("session joined , no media playing"),this.loadMedia()),this.session.addUpdateListener(this.sessionUpdateListener.bind(this)))},t.prototype.receiverListener=function(e){"available"===e&&(console.log("receiver found"),this.show())},t.prototype.sessionUpdateListener=function(e){e||(this.session=null,clearInterval(this.timer),this.onStopAppSuccess())},t.prototype.doLaunch=function(){console.log("launching app..."),chrome.cast.requestSession(this.sessionListener.bind(this),this.castError.bind(this)),this.timer&&clearInterval(this.timer)},t.prototype.onRequestSessionSuccess=function(e){console.log("session success: "+e.sessionId),this.session=e,this.loadMedia(),this.session.addUpdateListener(this.sessionUpdateListener.bind(this))},t.prototype.loadMedia=function(){if(console.log("load media called"),!this.session)return void console.log("no session");this.addClass("connected"),this.player_.controlBar.audioSwitcher&&(this.player_.controlBar.audioSwitcher.style.display="none");var e=new chrome.cast.media.MediaInfo(this.player_.currentSrc(),this.player_.currentType());if(this.settings.metadata){e.metadata=new chrome.cast.media.GenericMediaMetadata,ref=this.settings.metadata;for(key in ref)value=ref[key],e.metadata[key]=value}this.player_.options_.poster&&(image=new chrome.cast.Image(this.player_.options_.poster),e.metadata.images=[image]);var t=this.player().textTracks(),i=this.player().remoteTextTrackEls(),s=[],r=0,o=void 0,n=void 0,a=0,c=void 0;if(t){for(r=0;r<t.length;r++)n=t.tracks_[r],o=i&&i.trackElements_&&i.trackElements_[r],a++,c=new chrome.cast.media.Track(a,chrome.cast.media.TrackType.TEXT),c.trackContentId=o?o.src:"caption_"+n.language,c.subtype=chrome.cast.media.TextTrackType.SUBTITLES,c.name=n.label,c.language=n.language,c.customData=null,s.push(c);e.textTrackStyle=new chrome.cast.media.TextTrackStyle,e.textTrackStyle.foregroundColor="#FFFFFF",e.textTrackStyle.backgroundColor="#000000",e.textTrackStyle.edgeType=chrome.cast.media.TextTrackEdgeType.DROP_SHADOW,e.textTrackStyle.windowType=chrome.cast.media.TextTrackWindowType.ROUNDED_CORNERS}s.length&&(e.tracks=s);var p=new chrome.cast.media.LoadRequest(e);p.autoplay=!0,p.currentTime=this.player_.currentTime(),this.session.loadMedia(p,this.onMediaDiscovered.bind(this),this.castError);var s=this.player().textTracks();if(s){var h=this;!function(){var e=h.handleTextTracksChange.bind(h);s.addEventListener("change",e),h.on("dispose",function(){s.removeEventListener("change",e)}),h.handleTextTracksChange()}()}this.session.addUpdateListener(this.sessionUpdateListener.bind(this))},t.prototype.handleTextTracksChange=function(){var e=[],t=this.player().textTracks();if(t){for(var i=0;i<t.length;i++){var s=t[i];"showing"===s.mode?e.push(i+1):"disabled"===s.mode}this.apiMedia&&(this.tracksInfoRequest=new chrome.cast.media.EditTracksInfoRequest(e),this.apiMedia.editTracksInfo(this.tracksInfoRequest,this.onTrackSuccess.bind(this),this.onTrackError.bind(this)))}},t.prototype.onTrackSuccess=function(){videojs.log("track added")},t.prototype.onTrackError=function(){videojs.log("track Error")},t.prototype.onMediaDiscovered=function(e){this.player_.controlBar.audioSwitcher&&(this.player_.controlBar.audioSwitcher.style.display="none"),this.addClass("connected"),this.apiMedia=e,this.apiMedia.addUpdateListener(this.onMediaStatusUpdate.bind(this)),this.startProgressTimer(this.incrementMediaTime.bind(this)),this.oldTech_=this.player_.techName_,this.oldSrc_=this.player_.currentSrc(),this.player_.loadTech_("ChromecastTech",{currentSrc:this.player_.currentSrc(),receiver:this.session.receiver.friendlyName,chromecastComponent:this}),this.casting=!0,this.paused=this.player_.paused(),this.inactivityTimeout=this.player_.options_.inactivityTimeout,this.player_.options_.inactivityTimeout=0,this.player_.removeClass("not-hover"),this.player_.on("mouseout",this.doNotHover.bind(this)),this.player_.userActive(!0)},t.prototype.doNotHover=function(){return this.player_.removeClass("not-hover")},t.prototype.onMediaStatusUpdate=function(e){if(this.apiMedia)switch(this.currentMediaTime=this.apiMedia.currentTime,this.apiMedia.playerState){case chrome.cast.media.PlayerState.IDLE:return this.currentMediaTime=0,this.trigger("timeupdate"),this.onStopAppSuccess();case chrome.cast.media.PlayerState.PAUSED:if(this.paused)return;return this.player_.pause(),this.paused=!0;case chrome.cast.media.PlayerState.PLAYING:if(!this.paused)return;return this.player_.play(),this.paused=!1}},t.prototype.startProgressTimer=function(e){return this.timer&&(clearInterval(this.timer),this.timer=null),this.timer=setInterval(e.bind(this),this.timerStep)},t.prototype.play=function(){return this.apiMedia&&this.paused?(this.apiMedia.play(null,this.mediaCommandSuccessCallback.bind(this,"Playing: "+this.apiMedia.sessionId),this.handleTechError),this.paused=!1):void 0},t.prototype.pause=function(){return this.apiMedia?this.paused?void 0:(this.apiMedia.pause(null,this.mediaCommandSuccessCallback.bind(this,"Paused: "+this.apiMedia.sessionId),this.handleTechError),this.paused=!0):void 0},t.prototype.seekMedia=function(e){var t;return t=new chrome.cast.media.SeekRequest,t.currentTime=e,this.player_.controlBar.progressControl.seekBar.videoWasPlaying&&(t.resumeState=chrome.cast.media.ResumeState.PLAYBACK_START),this.apiMedia.seek(t,this.onSeekSuccess.bind(this,e),this.handleTechError)},t.prototype.onSeekSuccess=function(e){return this.currentMediaTime=e},t.prototype.setMediaVolume=function(e,t){var i,s;if(this.apiMedia)return s=new chrome.cast.Volume,s.level=e,s.muted=t,this.currentVolume=s.level,this.muted=t,i=new chrome.cast.media.VolumeRequest,i.volume=s,this.apiMedia.setVolume(i,this.mediaCommandSuccessCallback.bind(this,"Volume changed"),this.handleTechError),this.player_.trigger("volumechange")},t.prototype.incrementMediaTime=function(){return this.apiMedia.playerState===chrome.cast.media.PlayerState.PLAYING?this.currentMediaTime<this.apiMedia.media.duration?(this.currentMediaTime+=1,this.trigger("timeupdate")):(this.currentMediaTime=0,clearInterval(this.timer)):void 0},t.prototype.mediaCommandSuccessCallback=function(e,t){return videojs.log(e)},t.prototype.handleTechError=function(){return videojs.log("error")},t.prototype.stopCasting=function(){return this.session.stop(this.onStopAppSuccess.bind(this),this.handleTechError)},t.prototype.onStopAppSuccess=function(){var e=this.player_.currentTime();this.casting=!1,this.removeClass("connected"),this.player_.controlBar.audioSwitcher&&(this.player_.controlBar.audioSwitcher.style.display="inline"),this.player_.src(this.player_.options_.sources),this.player_.paused()||this.player_.one("seeked",function(){this.player_.play()}),this.player_.ads.contentSrc=this.player_.currentSrc(),this.player_.currentTime(e),this.player_.play(),this.player_.options_.inactivityTimeout=this.inactivityTimeout,this.session=null},t.prototype.buildCSSClass=function(){return t.__super__.buildCSSClass.apply(this,arguments)+"vjs-chromecast-button"},t.prototype.handleClick=function(){return t.__super__.handleClick.apply(this,arguments),this.casting?this.stopCasting():this.doLaunch()},t}(s),videojs.registerComponent("ChromecastComponent",e),i=videojs.getTech("Tech"),t=function(e){function t(e){this.featuresVolumeControl=!0,this.movingMediaElementInDOM=!1,this.featuresFullscreenResize=!1,this.featuresProgressEvents=!0,this.receiver=e.source.receiver,this.player_id_=e.playerId,this.chromecastComponent_=e.source.chromecastComponent,this.poster_=e.poster,this.currentSrc_=e.source.currentSrc,t.__super__.constructor.call(this,e),this.triggerReady()}return r(t,e),t.isSupported=function(){return this.chromecastComponent_.apiInitialized},t.canPlaySource=function(e){return"video/mp4"===e.type||"video/webm"===e.type||"application/x-mpegURL"===e.type||"application/vnd.apple.mpegURL"===e.type},t.prototype.createEl=function(){var e;return e=document.createElement("div"),e.id=this.player_id_+"_chromecast_api",e.className="vjs-tech vjs-tech-chromecast",e.innerHTML='<div class="casting-image" style="background-image: url(\''+this.poster_+'\')"></div>\n<div class="casting-overlay">\n  <div class="casting-information">\n    <div class="casting-icon"></div>\n    <div class="casting-description"><small>'+this.localize("CASTING TO")+"</small><br>"+this.receiver+"</div>\n  </div>\n</div>",e},t.prototype.play=function(){return this.chromecastComponent_.play(),this.trigger("play")},t.prototype.pause=function(){return this.chromecastComponent_.pause(),this.trigger("pause")},t.prototype.paused=function(){return this.chromecastComponent_.paused},t.prototype.currentTime=function(){return this.chromecastComponent_.currentMediaTime},t.prototype.setCurrentTime=function(e){return this.chromecastComponent_.seekMedia(e)},t.prototype.currentSrc=function(e){return"undefined"!=typeof e&&videojs.log("TODO Should change source to: "+e),this.currentSrc_},t.prototype.src=function(e){return this.currentSrc(e)},t.prototype.duration=function(){return videojs.log("ChromecastTech got duration call??")},t.prototype.ended=function(){return!0},t.prototype.controls=function(){return!1},t.prototype.volume=function(){return this.chromecastComponent_.currentVolume},t.prototype.setVolume=function(e){return this.chromecastComponent_.setMediaVolume(e,!1)},t.prototype.muted=function(){return this.chromecastComponent_.muted},t.prototype.setMuted=function(e){return this.chromecastComponent_.setMediaVolume(this.chromecastComponent_.currentVolume,e)},t.prototype.supportsFullScreen=function(){return!1},t}(i),videojs.registerTech("ChromecastTech",t)}).call(this);